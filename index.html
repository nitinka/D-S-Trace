<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>D-s-trace by nitinka</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>D-s-trace</h1>
          <h2>Simplest Distributed Tracing Platform. </h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/nitinka/D-S-Trace/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/nitinka/D-S-Trace/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/nitinka/D-S-Trace" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a name="d-s-trace--d-stress-" class="anchor" href="#d-s-trace--d-stress-"><span class="octicon octicon-link"></span></a>D-S-TRACE ( D-Stress )</h1>

<p>Distributed tracing in complex distributed application environment is a very basic and most needed capability. I have used available solutions like Zipkin, i must admit not a quickest solution(niether to deploy nor to use) to get started with.<br>
With D-S-Trace I intent to provide distributed tracing platform which you can setup in little time and get started. <br><b>To learn more about philosophy of distributed tracing : <a href="http://www.slideshare.net/dkuebrich/distributed-tracing-in-5-minutes">http://www.slideshare.net/dkuebrich/distributed-tracing-in-5-minutes</a></b><br><br><img src="https://github.com/nitinka/D-S-Trace/raw/master/images/dstrace.png" alt="Alt Image"><br><br></p>

<h3>
<a name="dstrace-consist-of-3-components-" class="anchor" href="#dstrace-consist-of-3-components-"><span class="octicon octicon-link"></span></a>DSTrace consist of 3 components :</h3>

<p><b>1) dstrace-publisher</b> : applications should include this library to start sending various events that they want to trace. These events are published to Redis or directly to dstrace-archive depending upon configuration. Publishing via Redis makes the deployment more reliable.<br><b>2) dstrace-archive</b> : receive published events (directly from publisher as http call or subscribed message from Redis topic) and archive message to elastic search.<br><b>3) dstrace-console</b> : Set of rest end points and UI to search, relate and visualize distributed traces.<br></p>

<hr size="2"><h3>
<a name="deployment-" class="anchor" href="#deployment-"><span class="octicon octicon-link"></span></a>Deployment: </h3>

<p><b>1) Install Redis</b>: Follow <a href="http://redis.io/topics/quickstart">http://redis.io/topics/quickstart</a><br><b>2) Install elasticsearch</b>:</p>

<pre>
1) Download elastic Search : https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-0.90.7.zip
2) unzip
3) cd bin
4) ./elasticsearch -f
5) curl -XPOST 'http://localhost:9200/trace' â€“d '
{
  "mappings": {
    "event": {
      "properties": {
        "application": {
          "type": "string",
          "index": "not_analyzed"
        },
        "businessUnit": {
          "type": "string",
          "index": "not_analyzed"
        },
        "eventId": {
          "type": "string",
          "index": "not_analyzed"
        },
        "traceId": {
          "type": "string",
          "index": "not_analyzed"
        },
        "eventName": {
          "type": "string",
          "index": "not_analyzed"
        },
        "host": {
          "type": "string",
          "index": "not_analyzed"
        },
        "spanName": {
          "type": "string",
          "index": "not_analyzed"
        },
        "spanId": {
          "type": "string",
          "index": "not_analyzed"
        },
        "tags": {
          "type": "object"
        },
        "timestamp": {
          "type": "long"
        }
      }
    },
    "businessUnit": {
      "properties": {
        "name": {
          "type": "string",
          "index": "not_analyzed"
        },
        "applications": {
          "type": "nested",
          "index": "not_analyzed",
          "properties": {
            "name": {
              "type": "string"
            },
            "operations": {
              "type": "nested",
              "index": "not_analyzed",
              "properties": {
                "name": {
                  "type": "string",
                  "index": "not_analyzed"
                }
              }
            }
          }
        }
      }
    }
  }
}'
</pre>

<p><b>3) Install D-S-Trace Services </b>:</p>

<pre>
1) git clone https://github.com/nitinka/D-S-Trace.git 
2) cd D-S-Trace
3) mvn clean compile package
4) cd dstrace-archive
5) mvn exec:java
6) Open another console
7) cd dstrace-console
8) mvn exec:java
</pre>

<p><b>4) Done</b></p>

<hr size="2"><h3>
<a name="getting-started-with-tracing-" class="anchor" href="#getting-started-with-tracing-"><span class="octicon octicon-link"></span></a>Getting Started With Tracing: </h3>

<p><b>1) Include Publisher Library in your application :</b> allows users to publish events to dstrace-archive service.</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;repositories&gt;</span>
    <span class="nt">&lt;repository&gt;</span>
        <span class="nt">&lt;id&gt;</span>nitinka.mvn.repo<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;url&gt;</span>https://github.com/nitinka/mvn-repo/raw/master<span class="nt">&lt;/url&gt;</span>
        <span class="c">&lt;!-- use snapshot version --&gt;</span>
        <span class="nt">&lt;snapshots&gt;</span>
            <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;updatePolicy&gt;</span>always<span class="nt">&lt;/updatePolicy&gt;</span>
        <span class="nt">&lt;/snapshots&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>
<span class="nt">&lt;/repositories&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>nitinka.dstrace.publisher<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>dstrace-publisher<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.0.4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span> 
</pre></div>

<p></p>

<p><b>2) Initialize Publisher/Trace Configuration</b> :Initialize Tracer during the initialization of your application.</p>

<div class="highlight highlight-java"><pre><span class="n">TracerConfiguration</span> <span class="n">configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TracerConfiguration</span><span class="o">();</span>
        <span class="n">configuration</span><span class="o">.</span>
                <span class="nf">setEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span>
                <span class="n">setBusinessUnit</span><span class="o">(</span><span class="s">"bu1"</span><span class="o">).</span>
                <span class="n">setApplication</span><span class="o">(</span><span class="s">"app1"</span><span class="o">).</span>
                <span class="n">setEventQueueSize</span><span class="o">(</span><span class="mi">100000</span><span class="o">).</span>
                <span class="n">setHost</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">).</span>
                <span class="n">setSamplePercentage</span><span class="o">(</span><span class="mi">100</span><span class="o">).</span>
                <span class="n">setPublishConfiguration</span><span class="o">(</span><span class="k">new</span> <span class="n">EventPublishConfiguration</span><span class="o">().</span>
                        <span class="n">setEventPublishDelay</span><span class="o">(</span><span class="mi">5000</span><span class="o">).</span>
                        <span class="n">setEventPublishSize</span><span class="o">(</span><span class="mi">100</span><span class="o">).</span>
                        <span class="n">setEnqueueFailedMessages</span><span class="o">(</span><span class="kc">false</span><span class="o">).</span>
                        <span class="n">setPublisherClass</span><span class="o">(</span><span class="s">"nitinka.dstrace.publish.RedisPublisherImpl"</span><span class="o">).</span>
                        <span class="n">setPublisherConfig</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;(){</span>
                            <span class="o">{</span>
                                <span class="n">put</span><span class="o">(</span><span class="s">"redisHost"</span><span class="o">,</span><span class="s">"localhost"</span><span class="o">);</span> 
                                <span class="n">put</span><span class="o">(</span><span class="s">"redisPort"</span><span class="o">,</span><span class="s">"trace-events"</span><span class="o">);</span>
                            <span class="o">}</span>
                        <span class="o">}));</span>

        <span class="n">Tracer</span><span class="o">.</span><span class="na">initialize</span><span class="o">(</span><span class="n">configuration</span><span class="o">);</span>
</pre></div>

<p><b>3) Publish events from your app</b> :Use Trace class to publish events</p>

<div class="highlight highlight-java"><pre>        <span class="n">Tracer</span><span class="o">.</span><span class="na">setCurrentTraceId</span><span class="o">(</span><span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span> <span class="c1">// Should be unique transaction id shared across application</span>
        <span class="n">Tracer</span><span class="o">.</span><span class="na">startSpan</span><span class="o">(</span><span class="s">"span1"</span><span class="o">,</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="n">Tracer</span><span class="o">.</span><span class="na">startSpan</span><span class="o">(</span><span class="s">"span1.1"</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="n">Tracer</span><span class="o">.</span><span class="na">startSpan</span><span class="o">(</span><span class="s">"span1.1.1"</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="n">Tracer</span><span class="o">.</span><span class="na">startSpan</span><span class="o">(</span><span class="s">"span1.1.1.1"</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="n">Tracer</span><span class="o">.</span><span class="na">startSpan</span><span class="o">(</span><span class="s">"span1.1.1.1.1"</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
        <span class="n">Tracer</span><span class="o">.</span><span class="na">endSpan</span><span class="o">();</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
        <span class="n">Tracer</span><span class="o">.</span><span class="na">endSpan</span><span class="o">();</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
        <span class="n">Tracer</span><span class="o">.</span><span class="na">endSpan</span><span class="o">();</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
        <span class="n">Tracer</span><span class="o">.</span><span class="na">endSpan</span><span class="o">();</span>
        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
        <span class="n">Tracer</span><span class="o">.</span><span class="na">endSpan</span><span class="o">();</span>
</pre></div>

<p><b>4) Get the basic trace view </b> :Use trace ID to get the complete distributed transaction</p>

<pre>
http://localhost:8888/index.htm?traceId=5993126e-24e3-4352-99f4-9a425b6fadd9
</pre>

<p><img src="https://github.com/nitinka/D-S-Trace/raw/master/images/sample-trace.png" alt="Alt Image"><b>5) Get the raw trace(json)</b> :Use trace ID to get the complete distributed transaction</p>

<pre>
http://localhost:8888/dstrace-console/traces/5993126e-24e3-4352-99f4-9a425b6fadd9
{
  "traceId": "5993126e-24e3-4352-99f4-9a425b6fadd9",
  "startTime": 1384939975603,
  "endTime": 1384939981010,
  "durationMS": 5407,
  "firstSpan": "1",
  "lastSpan": "1",
  "spans": {
    "1": {
      "spanId": "1",
      "spanName": "span1",
      "events": [
        {
          "businessUnit": "bu1",
          "application": "app1",
          "host": "localhost",
          "spanName": "span1",
          "traceId": "5993126e-24e3-4352-99f4-9a425b6fadd9",
          "eventId": "a45cae4f-4f86-40ab-82d7-f7f584bfaf05",
          "spanId": "1",
          "parentSpanId": null,
          "eventName": "Start",
          "timestamp": 1384939975603,
          "tags": {
            
          }
        },
        {
          "businessUnit": "bu1",
          "application": "app1",
          "host": "localhost",
          "spanName": "span1",
          "traceId": "5993126e-24e3-4352-99f4-9a425b6fadd9",
          "eventId": "b668d9b5-7182-42c6-89ea-b4fc0c99dfc0",
          "spanId": "1",
          "parentSpanId": null,
          "eventName": "End",
          "timestamp": 1384939981010,
          "tags": {
            
          }
        }
      ],
      "childSpans": {
        "2": {
          "spanId": "2",
          "spanName": "span1.1",
          "events": [
            {
              "businessUnit": "bu1",
              "application": "app1",
              "host": "localhost",
              "spanName": "span1.1",
              "traceId": "5993126e-24e3-4352-99f4-9a425b6fadd9",
              "eventId": "328289a9-8660-4bbc-aaee-03ac3d6e71b3",
              "spanId": "2",
              "parentSpanId": "1",
              "eventName": "Start",
              "timestamp": 1384939975704,
              "tags": {
                
              }
            },
            {
              "businessUnit": "bu1",
              "application": "app1",
              "host": "localhost",
              "spanName": "span1.1",
              "traceId": "5993126e-24e3-4352-99f4-9a425b6fadd9",
              "eventId": "3745dcd9-2077-4373-bd6e-245eacf28b8e",
              "spanId": "2",
              "parentSpanId": "1",
              "eventName": "End",
              "timestamp": 1384939980009,
              "tags": {
                
              }
            }
          ],
          "childSpans": {
            "3": {
              "spanId": "3",
              "spanName": "span1.1.1",
              "events": [
                {
                  "businessUnit": "bu1",
                  "application": "app1",
                  "host": "localhost",
                  "spanName": "span1.1.1",
                  "traceId": "5993126e-24e3-4352-99f4-9a425b6fadd9",
                  "eventId": "ee9391f1-add7-48e6-a287-33152723ea11",
                  "spanId": "3",
                  "parentSpanId": "2",
                  "eventName": "Start",
                  "timestamp": 1384939975805,
                  "tags": {
                    
                  }
                },
                {
                  "businessUnit": "bu1",
                  "application": "app1",
                  "host": "localhost",
                  "spanName": "span1.1.1",
                  "traceId": "5993126e-24e3-4352-99f4-9a425b6fadd9",
                  "eventId": "fb9ca561-41c7-4338-959d-92ce28877860",
                  "spanId": "3",
                  "parentSpanId": "2",
                  "eventName": "End",
                  "timestamp": 1384939979009,
                  "tags": {
                    
                  }
                }
              ],
              "childSpans": {
                "4": {
                  "spanId": "4",
                  "spanName": "span1.1.1.1",
                  "events": [
                    {
                      "businessUnit": "bu1",
                      "application": "app1",
                      "host": "localhost",
                      "spanName": "span1.1.1.1",
                      "traceId": "5993126e-24e3-4352-99f4-9a425b6fadd9",
                      "eventId": "355bf2a1-2fb1-490c-8e08-8085ba11f86a",
                      "spanId": "4",
                      "parentSpanId": "3",
                      "eventName": "Start",
                      "timestamp": 1384939975905,
                      "tags": {
                        
                      }
                    },
                    {
                      "businessUnit": "bu1",
                      "application": "app1",
                      "host": "localhost",
                      "spanName": "span1.1.1.1",
                      "traceId": "5993126e-24e3-4352-99f4-9a425b6fadd9",
                      "eventId": "076071cb-7592-4176-b430-cf36aabe8399",
                      "spanId": "4",
                      "parentSpanId": "3",
                      "eventName": "End",
                      "timestamp": 1384939978008,
                      "tags": {
                        
                      }
                    }
                  ],
                  "childSpans": {
                    "5": {
                      "spanId": "5",
                      "spanName": "span1.1.1.1.1",
                      "events": [
                        {
                          "businessUnit": "bu1",
                          "application": "app1",
                          "host": "localhost",
                          "spanName": "span1.1.1.1.1",
                          "traceId": "5993126e-24e3-4352-99f4-9a425b6fadd9",
                          "eventId": "6edffcca-f351-4b5e-b68d-9e33678c04ce",
                          "spanId": "5",
                          "parentSpanId": "4",
                          "eventName": "Start",
                          "timestamp": 1384939976006,
                          "tags": {
                            
                          }
                        },
                        {
                          "businessUnit": "bu1",
                          "application": "app1",
                          "host": "localhost",
                          "spanName": "span1.1.1.1.1",
                          "traceId": "5993126e-24e3-4352-99f4-9a425b6fadd9",
                          "eventId": "9724f3d2-d314-49e0-8874-95891144d1f3",
                          "spanId": "5",
                          "parentSpanId": "4",
                          "eventName": "End",
                          "timestamp": 1384939977007,
                          "tags": {
                            
                          }
                        }
                      ],
                      "childSpans": {
                        
                      },
                      "duration": 1001
                    }
                  },
                  "duration": 2103
                }
              },
              "duration": 3204
            }
          },
          "duration": 4305
        }
      },
      "duration": 5407
    }
  }
}

</pre>
        </section>

        <footer>
          D-s-trace is maintained by <a href="https://github.com/nitinka">nitinka</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>