{"name":"D-s-trace","tagline":"Simplest Distributed Tracing Platform. ","body":"D-S-TRACE ( D-Stress )\r\n=========\r\nDistributed tracing in complex distributed application environment is a very basic and most needed capability. I have used available solutions like Zipkin, i must admit not a quickest solution(niether to deploy nor to use) to get started with.<br>\r\nWith D-S-Trace I intent to provide distributed tracing platform which you can setup in little time and get started. <br>\r\n<b>To learn more about philosophy of distributed tracing : http://www.slideshare.net/dkuebrich/distributed-tracing-in-5-minutes</b><br><br>\r\n![Alt Image](https://github.com/nitinka/D-S-Trace/raw/master/images/dstrace.png)\r\n<br><br>\r\n<h3>DSTrace consist of 3 components :</h3>\r\n<b>1) dstrace-publisher</b> : applications should include this library to start sending various events that they want to trace. These events are published to Redis or directly to dstrace-archive depending upon configuration. Publishing via Redis makes the deployment more reliable.<br>\r\n<b>2) dstrace-archive</b> : receive published events (directly from publisher as http call or subscribed message from Redis topic) and archive message to elastic search.<br>\r\n<b>3) dstrace-console</b> : Set of rest end points and UI to search, relate and visualize distributed traces.<br>\r\n<hr size=2>\r\n<h3>Deployment: </h3>\r\n<b>1) Install Redis</b>: Follow http://redis.io/topics/quickstart<br>\r\n<b>2) Install elasticsearch</b>:\r\n<pre>\r\n1) Download elastic Search : https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-0.90.7.zip\r\n2) unzip\r\n3) cd bin\r\n4) ./elasticsearch -f\r\n5) curl -XPOST 'http://localhost:9200/trace' â€“d '\r\n{\r\n  \"mappings\": {\r\n    \"event\": {\r\n      \"properties\": {\r\n        \"application\": {\r\n          \"type\": \"string\",\r\n          \"index\": \"not_analyzed\"\r\n        },\r\n        \"businessUnit\": {\r\n          \"type\": \"string\",\r\n          \"index\": \"not_analyzed\"\r\n        },\r\n        \"eventId\": {\r\n          \"type\": \"string\",\r\n          \"index\": \"not_analyzed\"\r\n        },\r\n        \"traceId\": {\r\n          \"type\": \"string\",\r\n          \"index\": \"not_analyzed\"\r\n        },\r\n        \"eventName\": {\r\n          \"type\": \"string\",\r\n          \"index\": \"not_analyzed\"\r\n        },\r\n        \"host\": {\r\n          \"type\": \"string\",\r\n          \"index\": \"not_analyzed\"\r\n        },\r\n        \"spanName\": {\r\n          \"type\": \"string\",\r\n          \"index\": \"not_analyzed\"\r\n        },\r\n        \"spanId\": {\r\n          \"type\": \"string\",\r\n          \"index\": \"not_analyzed\"\r\n        },\r\n        \"tags\": {\r\n          \"type\": \"object\"\r\n        },\r\n        \"timestamp\": {\r\n          \"type\": \"long\"\r\n        }\r\n      }\r\n    },\r\n    \"businessUnit\": {\r\n      \"properties\": {\r\n        \"name\": {\r\n          \"type\": \"string\",\r\n          \"index\": \"not_analyzed\"\r\n        },\r\n        \"applications\": {\r\n          \"type\": \"nested\",\r\n          \"index\": \"not_analyzed\",\r\n          \"properties\": {\r\n            \"name\": {\r\n              \"type\": \"string\"\r\n            },\r\n            \"operations\": {\r\n              \"type\": \"nested\",\r\n              \"index\": \"not_analyzed\",\r\n              \"properties\": {\r\n                \"name\": {\r\n                  \"type\": \"string\",\r\n                  \"index\": \"not_analyzed\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}'\r\n</pre>\r\n<b>3) Install D-S-Trace Services </b>:\r\n<pre>\r\n1) git clone https://github.com/nitinka/D-S-Trace.git \r\n2) cd D-S-Trace\r\n3) mvn clean compile package\r\n4) cd dstrace-archive\r\n5) mvn exec:java\r\n6) Open another console\r\n7) cd dstrace-console\r\n8) mvn exec:java\r\n</pre>\r\n<b>4) Done</b>\r\n<hr size=2>\r\n<h3>Getting Started With Tracing: </h3>\r\n<b>1) Include Publisher Library in your application :</b> allows users to publish events to dstrace-archive service.\r\n\r\n```xml\r\n<repositories>\r\n    <repository>\r\n        <id>nitinka.mvn.repo</id>\r\n        <url>https://github.com/nitinka/mvn-repo/raw/master</url>\r\n        <!-- use snapshot version -->\r\n        <snapshots>\r\n            <enabled>true</enabled>\r\n            <updatePolicy>always</updatePolicy>\r\n        </snapshots>\r\n    </repository>\r\n</repositories>\r\n\r\n<dependency>\r\n    <groupId>nitinka.dstrace.publisher</groupId>\r\n    <artifactId>dstrace-publisher</artifactId>\r\n    <version>0.0.4</version>\r\n</dependency> \r\n```\r\n</pre>\r\n\r\n<b>2) Initialize Publisher/Trace Configuration</b> :Initialize Tracer during the initialization of your application.\r\n```java\r\nTracerConfiguration configuration = new TracerConfiguration();\r\n        configuration.\r\n                setEnabled(true).\r\n                setBusinessUnit(\"bu1\").\r\n                setApplication(\"app1\").\r\n                setEventQueueSize(100000).\r\n                setHost(\"localhost\").\r\n                setSamplePercentage(100).\r\n                setPublishConfiguration(new EventPublishConfiguration().\r\n                        setEventPublishDelay(5000).\r\n                        setEventPublishSize(100).\r\n                        setEnqueueFailedMessages(false).\r\n                        setPublisherClass(\"nitinka.dstrace.publish.RedisPublisherImpl\").\r\n                        setPublisherConfig(new HashMap<String, Object>(){\r\n                            {\r\n                                put(\"redisHost\",\"localhost\"); \r\n                                put(\"redisPort\",\"trace-events\");\r\n                            }\r\n                        }));\r\n\r\n        Tracer.initialize(configuration);\r\n```\r\n<b>3) Publish events from your app</b> :Use Trace class to publish events\r\n```java\r\n        Tracer.setCurrentTraceId(UUID.randomUUID().toString()); // Should be unique transaction id shared across application\r\n        Tracer.startSpan(\"span1\",null, null);\r\n        Thread.sleep(100);\r\n        Tracer.startSpan(\"span1.1\", null, null);\r\n        Thread.sleep(100);\r\n        Tracer.startSpan(\"span1.1.1\", null, null);\r\n        Thread.sleep(100);\r\n        Tracer.startSpan(\"span1.1.1.1\", null, null);\r\n        Thread.sleep(100);\r\n        Tracer.startSpan(\"span1.1.1.1.1\", null, null);\r\n        Thread.sleep(1000);\r\n        Tracer.endSpan();\r\n        Thread.sleep(1000);\r\n        Tracer.endSpan();\r\n        Thread.sleep(1000);\r\n        Tracer.endSpan();\r\n        Thread.sleep(1000);\r\n        Tracer.endSpan();\r\n        Thread.sleep(1000);\r\n        Tracer.endSpan();\r\n```\r\n\r\n<b>4) Get the basic trace view </b> :Use trace ID to get the complete distributed transaction\r\n<pre>\r\nhttp://localhost:8888/index.htm?traceId=5993126e-24e3-4352-99f4-9a425b6fadd9\r\n</pre>\r\n![Alt Image](https://github.com/nitinka/D-S-Trace/raw/master/images/sample-trace.png)\r\n<b>5) Get the raw trace(json)</b> :Use trace ID to get the complete distributed transaction\r\n<pre>\r\nhttp://localhost:8888/dstrace-console/traces/5993126e-24e3-4352-99f4-9a425b6fadd9\r\n{\r\n  \"traceId\": \"5993126e-24e3-4352-99f4-9a425b6fadd9\",\r\n  \"startTime\": 1384939975603,\r\n  \"endTime\": 1384939981010,\r\n  \"durationMS\": 5407,\r\n  \"firstSpan\": \"1\",\r\n  \"lastSpan\": \"1\",\r\n  \"spans\": {\r\n    \"1\": {\r\n      \"spanId\": \"1\",\r\n      \"spanName\": \"span1\",\r\n      \"events\": [\r\n        {\r\n          \"businessUnit\": \"bu1\",\r\n          \"application\": \"app1\",\r\n          \"host\": \"localhost\",\r\n          \"spanName\": \"span1\",\r\n          \"traceId\": \"5993126e-24e3-4352-99f4-9a425b6fadd9\",\r\n          \"eventId\": \"a45cae4f-4f86-40ab-82d7-f7f584bfaf05\",\r\n          \"spanId\": \"1\",\r\n          \"parentSpanId\": null,\r\n          \"eventName\": \"Start\",\r\n          \"timestamp\": 1384939975603,\r\n          \"tags\": {\r\n            \r\n          }\r\n        },\r\n        {\r\n          \"businessUnit\": \"bu1\",\r\n          \"application\": \"app1\",\r\n          \"host\": \"localhost\",\r\n          \"spanName\": \"span1\",\r\n          \"traceId\": \"5993126e-24e3-4352-99f4-9a425b6fadd9\",\r\n          \"eventId\": \"b668d9b5-7182-42c6-89ea-b4fc0c99dfc0\",\r\n          \"spanId\": \"1\",\r\n          \"parentSpanId\": null,\r\n          \"eventName\": \"End\",\r\n          \"timestamp\": 1384939981010,\r\n          \"tags\": {\r\n            \r\n          }\r\n        }\r\n      ],\r\n      \"childSpans\": {\r\n        \"2\": {\r\n          \"spanId\": \"2\",\r\n          \"spanName\": \"span1.1\",\r\n          \"events\": [\r\n            {\r\n              \"businessUnit\": \"bu1\",\r\n              \"application\": \"app1\",\r\n              \"host\": \"localhost\",\r\n              \"spanName\": \"span1.1\",\r\n              \"traceId\": \"5993126e-24e3-4352-99f4-9a425b6fadd9\",\r\n              \"eventId\": \"328289a9-8660-4bbc-aaee-03ac3d6e71b3\",\r\n              \"spanId\": \"2\",\r\n              \"parentSpanId\": \"1\",\r\n              \"eventName\": \"Start\",\r\n              \"timestamp\": 1384939975704,\r\n              \"tags\": {\r\n                \r\n              }\r\n            },\r\n            {\r\n              \"businessUnit\": \"bu1\",\r\n              \"application\": \"app1\",\r\n              \"host\": \"localhost\",\r\n              \"spanName\": \"span1.1\",\r\n              \"traceId\": \"5993126e-24e3-4352-99f4-9a425b6fadd9\",\r\n              \"eventId\": \"3745dcd9-2077-4373-bd6e-245eacf28b8e\",\r\n              \"spanId\": \"2\",\r\n              \"parentSpanId\": \"1\",\r\n              \"eventName\": \"End\",\r\n              \"timestamp\": 1384939980009,\r\n              \"tags\": {\r\n                \r\n              }\r\n            }\r\n          ],\r\n          \"childSpans\": {\r\n            \"3\": {\r\n              \"spanId\": \"3\",\r\n              \"spanName\": \"span1.1.1\",\r\n              \"events\": [\r\n                {\r\n                  \"businessUnit\": \"bu1\",\r\n                  \"application\": \"app1\",\r\n                  \"host\": \"localhost\",\r\n                  \"spanName\": \"span1.1.1\",\r\n                  \"traceId\": \"5993126e-24e3-4352-99f4-9a425b6fadd9\",\r\n                  \"eventId\": \"ee9391f1-add7-48e6-a287-33152723ea11\",\r\n                  \"spanId\": \"3\",\r\n                  \"parentSpanId\": \"2\",\r\n                  \"eventName\": \"Start\",\r\n                  \"timestamp\": 1384939975805,\r\n                  \"tags\": {\r\n                    \r\n                  }\r\n                },\r\n                {\r\n                  \"businessUnit\": \"bu1\",\r\n                  \"application\": \"app1\",\r\n                  \"host\": \"localhost\",\r\n                  \"spanName\": \"span1.1.1\",\r\n                  \"traceId\": \"5993126e-24e3-4352-99f4-9a425b6fadd9\",\r\n                  \"eventId\": \"fb9ca561-41c7-4338-959d-92ce28877860\",\r\n                  \"spanId\": \"3\",\r\n                  \"parentSpanId\": \"2\",\r\n                  \"eventName\": \"End\",\r\n                  \"timestamp\": 1384939979009,\r\n                  \"tags\": {\r\n                    \r\n                  }\r\n                }\r\n              ],\r\n              \"childSpans\": {\r\n                \"4\": {\r\n                  \"spanId\": \"4\",\r\n                  \"spanName\": \"span1.1.1.1\",\r\n                  \"events\": [\r\n                    {\r\n                      \"businessUnit\": \"bu1\",\r\n                      \"application\": \"app1\",\r\n                      \"host\": \"localhost\",\r\n                      \"spanName\": \"span1.1.1.1\",\r\n                      \"traceId\": \"5993126e-24e3-4352-99f4-9a425b6fadd9\",\r\n                      \"eventId\": \"355bf2a1-2fb1-490c-8e08-8085ba11f86a\",\r\n                      \"spanId\": \"4\",\r\n                      \"parentSpanId\": \"3\",\r\n                      \"eventName\": \"Start\",\r\n                      \"timestamp\": 1384939975905,\r\n                      \"tags\": {\r\n                        \r\n                      }\r\n                    },\r\n                    {\r\n                      \"businessUnit\": \"bu1\",\r\n                      \"application\": \"app1\",\r\n                      \"host\": \"localhost\",\r\n                      \"spanName\": \"span1.1.1.1\",\r\n                      \"traceId\": \"5993126e-24e3-4352-99f4-9a425b6fadd9\",\r\n                      \"eventId\": \"076071cb-7592-4176-b430-cf36aabe8399\",\r\n                      \"spanId\": \"4\",\r\n                      \"parentSpanId\": \"3\",\r\n                      \"eventName\": \"End\",\r\n                      \"timestamp\": 1384939978008,\r\n                      \"tags\": {\r\n                        \r\n                      }\r\n                    }\r\n                  ],\r\n                  \"childSpans\": {\r\n                    \"5\": {\r\n                      \"spanId\": \"5\",\r\n                      \"spanName\": \"span1.1.1.1.1\",\r\n                      \"events\": [\r\n                        {\r\n                          \"businessUnit\": \"bu1\",\r\n                          \"application\": \"app1\",\r\n                          \"host\": \"localhost\",\r\n                          \"spanName\": \"span1.1.1.1.1\",\r\n                          \"traceId\": \"5993126e-24e3-4352-99f4-9a425b6fadd9\",\r\n                          \"eventId\": \"6edffcca-f351-4b5e-b68d-9e33678c04ce\",\r\n                          \"spanId\": \"5\",\r\n                          \"parentSpanId\": \"4\",\r\n                          \"eventName\": \"Start\",\r\n                          \"timestamp\": 1384939976006,\r\n                          \"tags\": {\r\n                            \r\n                          }\r\n                        },\r\n                        {\r\n                          \"businessUnit\": \"bu1\",\r\n                          \"application\": \"app1\",\r\n                          \"host\": \"localhost\",\r\n                          \"spanName\": \"span1.1.1.1.1\",\r\n                          \"traceId\": \"5993126e-24e3-4352-99f4-9a425b6fadd9\",\r\n                          \"eventId\": \"9724f3d2-d314-49e0-8874-95891144d1f3\",\r\n                          \"spanId\": \"5\",\r\n                          \"parentSpanId\": \"4\",\r\n                          \"eventName\": \"End\",\r\n                          \"timestamp\": 1384939977007,\r\n                          \"tags\": {\r\n                            \r\n                          }\r\n                        }\r\n                      ],\r\n                      \"childSpans\": {\r\n                        \r\n                      },\r\n                      \"duration\": 1001\r\n                    }\r\n                  },\r\n                  \"duration\": 2103\r\n                }\r\n              },\r\n              \"duration\": 3204\r\n            }\r\n          },\r\n          \"duration\": 4305\r\n        }\r\n      },\r\n      \"duration\": 5407\r\n    }\r\n  }\r\n}\r\n\r\n</pre>\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}